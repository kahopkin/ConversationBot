!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}([function(e,t){e.exports=require("express-msteams-host")},function(e,t){e.exports=require("debug")},function(e,t){e.exports=require("botbuilder-dialogs")},function(e,t,i){e.exports=i(4)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(5),o=i(6),r=i(7),a=i(8),s=i(0),c=i(1),d=i(9),u=c("msteams");u("Initializing Microsoft Teams Express hosted App..."),i(10).config();const l=i(11),p=n(),y=process.env.port||process.env.PORT||3007;p.use(n.json({verify:(e,t,i,n)=>{e.rawBody=i.toString()}})),p.use(n.urlencoded({extended:!0})),p.set("views",r.join(__dirname,"/")),p.use(a("tiny")),p.use(d()),p.use("/scripts",n.static(r.join(__dirname,"web/scripts"))),p.use("/assets",n.static(r.join(__dirname,"web/assets"))),p.use(s.MsTeamsApiRouter(l)),p.use(s.MsTeamsPageRouter({root:r.join(__dirname,"web/"),components:l})),p.use("/",n.static(r.join(__dirname,"web/"),{index:"index.html"})),p.set("port",y),o.createServer(p).listen(y,()=>{u("Server running on "+y)})},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("dotenv")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.nonce={},function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i(12))},function(e,t,i){"use strict";var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){e.done?o(e.value):new i((function(t){t(e.value)})).then(a,s)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),a=i(1),s=i(2),c=i(13),d=i(14),u=i(15),l=i(17).TextEncoder;a("msteams");let p=class extends c.TeamsActivityHandler{constructor(e){super(),this.conversationState=e,this.dialogState=e.createProperty("dialogState"),this.dialogs=new s.DialogSet(this.dialogState),this.dialogs.add(new d.default("help")),this.onMessage(e=>o(this,void 0,void 0,(function*(){switch(e.activity.type){case c.ActivityTypes.Message:if(!e.activity.value){let t=c.TurnContext.removeRecipientMention(e.activity);if(t=t.toLowerCase(),t.startsWith("mentionme"))return void("personal"==e.activity.conversation.conversationType?yield this.handleMessageMentionMeOneOnOne(e):yield this.handleMessageMentionMeChannelConversation(e));if(t.startsWith("hello"))return void(yield e.sendActivity("Oh, hello to you as well!"));if(!t.startsWith("help")){const t={cardAction:"update",count:0},i=c.CardFactory.adaptiveCard({$schema:"http://adaptivecards.io/schemas/adaptive-card.json",type:"AdaptiveCard",version:"1.0",body:[{type:"Container",items:[{type:"TextBlock",text:"Adaptive card response",weight:"bolder",size:"large"}]},{type:"Container",items:[{type:"TextBlock",text:"Demonstrates how to respond with a card, update the card & ultimately delete the response.",wrap:!0}]}],actions:[{type:"Action.Submit",title:"Update card",data:t}]});return void(yield e.sendActivity({attachments:[i]}))}{const t=yield this.dialogs.createContext(e);yield t.beginDialog("help")}break}switch(e.activity.value.cardAction){case"update":yield this.updateCardActivity(e);break;case"delete":yield this.deleteCardActivity(e)}}return this.conversationState.saveChanges(e)}))),this.onConversationUpdate(e=>o(this,void 0,void 0,(function*(){if(e.activity.membersAdded&&0!==e.activity.membersAdded.length)for(const t in e.activity.membersAdded)if(e.activity.membersAdded[t].id===e.activity.recipient.id){const t=c.CardFactory.adaptiveCard(u.default);yield e.sendActivity({attachments:[t]})}}))),this.onMessageReaction(e=>o(this,void 0,void 0,(function*(){e.activity.reactionsAdded&&e.activity.reactionsAdded.forEach(t=>o(this,void 0,void 0,(function*(){"like"===t.type&&(yield e.sendActivity("Thank you!"))})))})))}handleMessageMentionMeOneOnOne(e){return o(this,void 0,void 0,(function*(){const t={mentioned:e.activity.from,text:`<at>${(new l).encode(e.activity.from.name)}</at>`,type:"mention"},i=c.MessageFactory.text(`Hi ${t.text} from a 1:1 chat.`);i.entities=[t],yield e.sendActivity(i)}))}handleMessageMentionMeChannelConversation(e){return o(this,void 0,void 0,(function*(){const t={mentioned:e.activity.from,text:`<at>${(new l).encode(e.activity.from.name)}</at>`,type:"mention"},i=c.MessageFactory.text(`Hi ${t.text}!`);i.entities=[t];const n=c.MessageFactory.text("*We are in a channel conversation*");yield e.sendActivities([i,n])}))}updateCardActivity(e){return o(this,void 0,void 0,(function*(){const t={cardAction:"update",count:e.activity.value.count+1},i=c.CardFactory.adaptiveCard({$schema:"http://adaptivecards.io/schemas/adaptive-card.json",type:"AdaptiveCard",version:"1.0",body:[{type:"Container",items:[{type:"TextBlock",text:"Adaptive card response",weight:"bolder",size:"large"}]},{type:"Container",items:[{type:"TextBlock",text:"Updated count: "+t.count,wrap:!0}]}],actions:[{type:"Action.Submit",title:"Update card",data:t},{type:"Action.Submit",title:"Delete card",data:{cardAction:"delete"}}]});yield e.updateActivity({attachments:[i],id:e.activity.replyToId,type:"message"})}))}deleteCardActivity(e){return o(this,void 0,void 0,(function*(){yield e.deleteActivity(e.activity.replyToId)}))}};p=n([r.BotDeclaration("/api/messages",new c.MemoryStorage,process.env.MICROSOFT_APP_ID,process.env.MICROSOFT_APP_PASSWORD)],p),t.ConversationalBot=p},function(e,t){e.exports=require("botbuilder")},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){e.done?o(e.value):new i((function(t){t(e.value)})).then(a,s)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=i(2);class r extends o.Dialog{constructor(e){super(e)}beginDialog(e,t){return n(this,void 0,void 0,(function*(){return e.context.sendActivity("I'm just a friendly but rather stupid bot, and right now I don't have any valuable help for you!"),yield e.endDialog()}))}}t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(16);t.default=n},function(e){e.exports={$schema:"http://adaptivecards.io/schemas/adaptive-card.json",type:"AdaptiveCard",version:"1.0",body:[{type:"TextBlock",spacing:"medium",size:"default",weight:"bolder",text:"Welcome to Conversational Bot",wrap:!0,maxLines:0},{type:"TextBlock",size:"default",isSubtle:!0,text:"Hello, nice to meet you!",wrap:!0,maxLines:0}],actions:[{type:"Action.OpenUrl",title:"Learn more about Yo Teams",url:"https://aka.ms/yoteams"},{type:"Action.OpenUrl",title:"Conversational Bot",url:"https://conversationalbot.azurewebsites.net"}]}},function(e,t){e.exports=require("util")}]);
//# sourceMappingURL=server.js.map